
@{
	ViewBag.Title = "Cobros disponibles";
	Layout = "~/Views/Shared/_Layout.cshtml";
}




<div class="hero-callout">


	<input type="hidden" id="Fecha_pago" value="" />
	
	<div class="row">
		<div class="col-sm-3" style="float:right;">
			<div class="input-group input-group-lg ">
				<span class="input-group-addon glyphicon glyphicon-search" id="sizing-addon1" aria-hidden="true"></span>
				<input type="search" id="txt_search" value="@ViewBag.valor" style="top:1px" class="form-control" placeholder="Buscar" aria-describedby="sizing-addon1" onkeyup="doSearch('tbl_headerCuotas', 'txt_search');doSearch('tbl_DetalleCuotas', 'txt_search');" />
			</div>
		</div>
	</div>

	<br />

	<table id="tbl_headerCuotas" class="table table-bordered">
		<thead class="btn-defaultColorLite">
			<tr>
				<th></th>
				<th>CLIENTE</th>
				<th class="text-center">BALANCE TOTAL</th>
				<th class="text-center">CAPITAL TOTAL</th>
				<th class="text-center">INTERES TOTAL</th>
				<th class="text-center">MORA TOTAL</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var CuotasVen in ViewBag.listCobrosHeader)
			{
				string isVisible = CuotasVen.CountT > 1 ? "1" : "0";

				<tr role="row" id="filaH-@CuotasVen.ClienteId" isVisible="1">
					<td align="center">
						@if (CuotasVen.CountT > 1)
						{
							<span class="glyphicon glyphicon-plus-sign  btn text-success" style="cursor:pointer" clienteId="@CuotasVen.ClienteId"></span>
						}
						else
						{
							<a class="control-label a"> @CuotasVen.FinID </a>
						}
					</td>


					<td>@CuotasVen.cliente</td>
					@*<td class="text-center">@CuotasVen.CountT</td>*@
					<td class="text-center">@CustomHtmlHelper.Helpers.HtmlExtensions.NumberFormat(CuotasVen.montoTotal) </td>@*@String.Format("{0:n}", CuotasVen.montoTotal)*@
					<td class="text-center">@CustomHtmlHelper.Helpers.HtmlExtensions.NumberFormat(CuotasVen.capitalTotal)</td>
					<td class="text-center">@CustomHtmlHelper.Helpers.HtmlExtensions.NumberFormat(CuotasVen.interesTotal)</td>
					<td class="text-center">@CustomHtmlHelper.Helpers.HtmlExtensions.NumberFormat(CuotasVen.moraTotal)</td>

				</tr>
				if (isVisible == "1")
				{
					<tr id="fila-@CuotasVen.ClienteId" style="display:none" isVisible="@isVisible">
						<td></td>

						<td colspan="5">
							@*@Html.Partial("_CobrosDetalleCliente", new { cliente = CuotasVen.cliente })*@
							@Html.Partial("_CobrosDetalleCliente", (SistemaImbrino.Models.View_cobrosHeader)CuotasVen)
						</td>
					</tr>
				}

			}
		</tbody>
	</table>
</div>
		


	@section scripts {

		<script type="text/javascript">
			var FinID = "";
			$(document).ready(function () {
				if ($("#txt_search").val() != "")
				{
					doSearch('tbl_headerCuotas', 'txt_search');
					doSearch('tbl_DetalleCuotas', 'txt_search');
				}
				$("#txt_search").change(function () {
					
					
				});
				$("#Fecha_pago").val("");
				$(".a").click(function () {
					FinID = $(this).text();
					mensajeCuotas();
				});			

				
				 function  mensajeCuotas()
				{
					 $("#Fecha_pago").val("");
					 MensajeFechaCorte().then((result) => {
						 if (result) {
							 var Fecha_pago = $("#Fecha_pago").val();
							 window.location.href = "@Url.Action("index","cobros")" + "?FinID=" + FinID + "&_Fecha_pago=" + Fecha_pago;
						 } 
						 

					 });
					 $('.swal2-input').attr("type", "date");
					 
					 
					
				

				}

				async function MensajeFechaCorte(_finID) {
					const { value: fecha } = await Swal.fire({
						title: 'Fecha pago',
						input: 'text',
						inputPlaceholder: 'dd-mm-yy',
						showCancelButton: true,
						inputValidator: (fecha) => {
							if (!fecha || fecha.length < 9) {
								return 'Debe ingresar una fecha valida'
							}
						}
					});

					
					if (fecha) {
						$("#Fecha_pago").val(fecha);
						return true;
					} else {
						
						return false;
					} 
					
					}
				

                //$('#tbl_headerCuotas').DataTable();
                $('#tbl_headerCuotas table').DataTable({
                    "searching": false,
                    "lengthChange": false,
                    "paging": false,
                    "ordering": true,
                    "info": false                    
                });
               
             
				$("#tbl_headerCuotas tbody span").click(function () {
					var cliente = $(this).attr("clienteId");
					var fila = $("#fila-" + cliente);
					var filaH = $("#filaH-" + cliente);

					if (fila.css("display") == "none") {
						fila.css("display", "table-row");
						// Se elimina el signo de mas(+) y se pone el de menos(-)
						$(this).removeClass("glyphicon-plus-sign");
						$(this).removeClass("text-success");
						$(this).addClass("glyphicon-minus-sign");
						$(this).addClass("text-danger");
						filaH.addClass("warning");

					} else {
						fila.css("display", "none");
						// Se elimina el signo de menos(-) y se pone el de mas(+)
						$(this).removeClass("glyphicon-minus-sign");
						$(this).removeClass("text-danger");
						$(this).addClass("glyphicon-plus-sign");
						$(this).addClass("text-success");
						filaH.removeClass("warning");
					}

				});
			});
		</script>

	}
